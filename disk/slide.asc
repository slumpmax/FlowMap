10 'USR0=initial draw
20 'USR1=scroll stick (0-8)
30 'USR2=show page (0-3)
40 'USR3=sprite walk (0=swap,1=walk)
50 'USR4=test FILL/DRAW routine
60 'USR5=mappage to RAM (0=load,1=save)
70 'USR6=draw ui (0=remove,1=draw)
80 'USR7=draw soft (0=remove,1=draw)
90 'USR8=clear screen
100 'USR9=test soft walk
110 'STRIG=back page
120 'F1=redraw:F2=50-60Hz
130 'F3=reload bin:F4=next bin
140 '0=show menu
150 '1=swap page
160 '2=page 0
170 '3=page 1
180 '4=reset
190 '5=mapx/mapy=1024
200 '6=reload pic
210 '7=restore MAP&TILE from RAM
220 '8=toggle hardware sprites
230 '9=remove soft sprite
240 '[=distance-1:]=distance+1
250 'INS=speed+1:DEL=speed-1
260 CLEAR200,&HC000:DEFINTA-Z
270 NS=4:VS=4:GOSUB850
280 ONSTOPGOSUB960:STOPON
290 SCREEN5,2,0:COLOR15,4,0
300 GOSUB860
310 ONKEYGOSUB750,780,790,840
320 KEY(1)ON:KEY(2)ON
330 KEY(3)ON:KEY(4)ON
340 ST=0:WK=-1:UI=0
350 X=-51:Y=-43
360 GOSUB650
370 POKE&HC000,XAND255
380 POKE&HC001,(XAND2047)\256
390 POKE&HC002,YAND255
400 POKE&HC003,(YAND2047)\256
410 U=USR0(0)
420 S0=STICK(0):IFS0THENWK=-1
430 IFWKANDUITHENU=USR6(0):UI=0
440 IF(WK)AND(NOTST)AND(NOTUI)THENU=USR1(S0)
450 P=PEEK(&HC008)
460 IFST<>STRIG(0)THENST=NOTST:IFSTTHENU=USR2(PXOR1)ELSEU=USR2(P)
470 I$=INKEY$
480 IFI$=CHR$(27)GOTO960
490 IFI$="0"THENGOSUB950
500 IFI$="1"THENU%=USR2(PXOR1):WK=0
510 IFI$="2"THENU%=USR2(0):WK=0
520 IFI$="3"THENU%=USR2(1):WK=0
530 IFI$="4"THEN350
540 IFI$="5"THEN770
550 IFI$="6"THENGOSUB860:GOSUB790
560 IFI$="7"THENU=USR5(0):GOSUB790
570 IFI$="8"THENPOKE&HC00C,1-PEEK(&HC00C)
580 IFI$="9"THENU=USR7(0)
590 IFI$="*"THENU=USR8(0)
600 IFI$="["THENPOKE&HC009,(PEEK(&HC009)-1)AND255
610 IFI$="]"THENPOKE&HC009,(PEEK(&HC009)+1)AND255
620 IFI$=CHR$(18)THENS%=PEEK(&HC00A):S%=S%*2+(S%=16)*16:POKE&HC00A,S%
630 IFI$=CHR$(127)THENS%=PEEK(&HC00A):S%=S%\2-(S%=1):POKE&HC00A,S%
640 U=USR3(-(S0>0)):GOTO420
650 FORI=0TO15:J=I*8
660 K=64+(IMOD4)*32
670 L=50+((I\4)MOD4)*32
680 POKE&HC020+J,L
690 POKE&HC021+J,K
700 POKE&HC022+J,I*2
710 POKE&HC024+J,L
720 POKE&HC025+J,K
730 POKE&HC026+J,I*2+1
740 NEXT:RETURN
750 RETURN410
760 POKE&HC05D,288-PEEK(&HC05D)
770 X=1024:Y=1024:GOTO370
780 VDP(10)=VDP(10)XOR2:RETURN
790 P=PEEK(&HC008):A=PEEK(&HC009)
800 X=PEEK(&HC000)OR(PEEK(&HC001)*256)
810 Y=PEEK(&HC002)OR(PEEK(&HC003)*256)
820 GOSUB850
830 POKE&HC008,P:POKE&HC009,A:RETURN360
840 VS=(VSMODNS)+1:GOTO790
850 BLOAD"slide"+CHR$(48+VS)+".bin",R:RETURN
860 SETPAGE,0:U=USR2(0):U=USR8(0)
870 BLOAD"dq2pat0c.sp5",S:COLOR=RESTORE
880 SETPAGE,1:CLS:U=USR2(1)
890 BLOAD"maptest.sr5",S
900 BLOAD"dq2pat0b.sr5",S
910 'COPY"dq2pat0b.gl5"TO(0,128)
920 SETPAGE0,0:BLOAD"dq2pat0a.sr5",S
930 U=USR5(1)
940 RETURN
950 U%=USR6(1):UI=-1:WK=0:RETURN
960 VDP(19)=0:SCREEN0,,1:COLOR15,4,4
970 KEY(1)OFF:KEY(2)OFF:KEY(3)OFF:KEY(4)OFF:STOPOFF
